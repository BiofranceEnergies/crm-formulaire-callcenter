<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulation Photovolta√Øque</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #dbe0e6;
      padding: 20px;
      max-width: 700px;
      margin: auto;
      color: #2c2c2c;
    }

    h1 {
      text-align: center;
      color: #333;
      font-size: 26px;
      margin-bottom: 15px;
    }

    .intro {
      background: #333b45;
      padding: 18px 22px;
      border-left: 4px solid #ffc107;
      color: #ffffff;
      font-size: 17px;
      line-height: 1.6;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .intro strong {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .form-section {
      background: #2c2f34;
      padding: 25px;
      border-radius: 8px;
      margin-bottom: 20px;
      color: white;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #e2e2e2;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: none;
      border-radius: 6px;
      background: #444;
      color: #fff;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #1f1f1f;
      color: white;
      border: 1px solid #999;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    button:active {
      transform: scale(0.98);
    }

    .recap {
      background: #f5f5f5;
      border-radius: 5px;
      padding: 18px;
      margin-bottom: 20px;
      color: #333;
      min-height: 160px;
    }

    .result {
      background: #f5f5f5;
      border-radius: 5px;
      padding: 18px;
      color: #1c4424;
      min-height: 260px;
    }

    .result p {
      margin-bottom: 10px;
    }

    .result p:last-child {
      font-style: italic;
      font-size: 0.95rem;
      margin-top: 15px;
    }

    @media (max-width: 500px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 22px;
      }
      .intro {
        font-size: 15px;
      }
    }
        @media (max-width: 600px) {
      #blocImagePV > div {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      #blocImagePV img {
        max-width: 100%;
      }

      #blocImagePV ul {
        text-align: left;
      }
    }

  </style>
</head>
<body>
  <!-- Bloc logo centr√© -->
  <div style="text-align: center; margin-bottom: 20px;">
    <img src="https://github.com/BiofranceEnergies/biofrance-images/blob/d21e60bacd91a0bbb74a626f515f7b6246bb6c28/Logo%20biofrance%20energie%20-webp.webp?raw=true" 
         alt="Logo Biofrance √ânergies" 
         style="max-width: 240px; height: auto;">
  </div>
  <h1>Comprenez en 3 secondes ce que le solaire peut vraiment vous faire √©conomiser.</h1>
  

<div class="intro">
    <p><strong>‚ö° Un simulateur unique, pens√© pour vous donner des r√©ponses, pas pour collecter vos coordonn√©es.</strong></p>
    <p>üìç Code postal, ‚ö° consommation, üí∂ facture‚Ä¶ en 3 secondes, votre √©conomie solaire estim√©e s‚Äôaffiche directement √† l‚Äô√©cran.</p>
    <p>‚ùå Aucun formulaire √† valider. üìû Aucun appel √† attendre.</p>
    <p>üí° Propuls√© par un moteur de calcul intelligent inspir√© de notre outil professionnel, bas√© sur les donn√©es locales de production solaire.</p>
    <p><strong>‚ÑπÔ∏è Chez Biofrance √ânergies, vous m√©ritez une info claire, fiable et imm√©diate avant de prendre une d√©cision.</strong></p>

  </div>



  <div class="form-section">
    <label for="codePostal">üìç Votre code postal</label>
    <input type="text" id="codePostal" placeholder="Ex : 75001">
      
    <label for="conso">üîå Consommation annuelle (kWh)</label>
    <input type="number" id="conso" placeholder="Ex : 7200">

    <label for="facture">üí∂ Facture annuelle (‚Ç¨)</label>
    <input type="number" id="facture" placeholder="Ex : 1680">

    <button id="simuler">üìä Lancer la simulation</button>
  </div>

  <div id="recap" class="recap" style="display: none;">

    <p><em>Les r√©sultats appara√Ætront ici apr√®s votre simulation.</em></p>
  </div>
<div id="blocImagePV" style="display: none; background: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); margin-bottom: 20px;">
  <div style="display: flex; align-items: flex-start; gap: 20px;">
    <img src="https://github.com/BiofranceEnergies/biofrance-images/blob/ed9f69eca63582630e403b6f239e7190254bce90/pano%20500w.webp?raw=true" alt="Panneaux photovolta√Øques 500W" style="max-width: 200px; height: auto; border-radius: 6px;">
    
    <div style="font-size: 0.95em; color: #333;">
      <h3 style="margin: 0 0 10px 0; font-size: 1.1em; color: #0056d6;">FLASH 500 Half-Cut Glass-Glass Topcon</h3>
      <ul style="margin: 0; padding-left: 18px;">
        <li><strong>Panneau compact :</strong> 1950 mm x 1134 mm x 30 mm, 27,1 Kg, 2,2 m¬≤</li>
        <li>Panneau bi-verre et bi-facial</li>
        <li>Gain de puissance de 10‚ÄØ% potentiel gr√¢ce √† la bifacialit√©</li>
        <li>Garantie 30 ans</li>
      </ul>
    </div>
  </div>
</div>


  <div id="resultat" class="result" style="display: none;">

    <p><em>Veuillez entrer votre consommation et votre facture pour voir le gain estim√©.</em></p>
  </div>


  <div id="offre" style="margin-top: 20px; display: none;">
    <div style="background: #f5f5f5; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
      <strong style="color: #0056d6; font-size: 1.1em; display: block; margin-bottom: 8px;">D√®s la premi√®re ann√©e</strong>
      <p>Vous r√©alisez une √©conomie d‚Äôenviron <span id="ecoMensuelle"></span> par mois, gr√¢ce √† l‚Äôautoconsommation et √† la valorisation de votre surplus.</p>
    </div>
    <div style="background: #f5f5f5; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
      <strong style="color: #0056d6; font-size: 1.1em; display: block; margin-bottom: 8px;">Ce que nous vous proposons</strong>
      <p>Remplacer ce paiement mensuel fait √† votre fournisseur d‚Äô√©lectricit√© par une solution concr√®te :</p>
      <p id="mensualiteTexte"></p>
    </div>
    <div style="background: #f5f5f5; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
      <strong style="color: #0056d6; font-size: 1.1em; display: block; margin-bottom: 8px;">Et chaque ann√©e</strong>
      <p>Le prix de l‚Äô√©lectricit√© augmente, vos √©conomies aussi. Votre mensualit√©, elle, reste fixe.</p>
    </div>
    <div style="background: #f5f5f5; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
      <strong style="color: #0056d6; font-size: 1.1em; display: block; margin-bottom: 8px;">Projection sur 15 ans</strong>
      <p>Votre √©conomie cumul√©e est estim√©e √† <span id="eco15ans"></span>.</p>
    </div>
    <div style="background: #e6f3e6; border-radius: 10px; padding: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
      <strong style="color: #0056d6; font-size: 1.1em; display: block; margin-bottom: 8px;">Vous ne subissez plus votre facture</strong>
      <p>Vous investissez dans votre propre √©lectricit√©. C‚Äôest un choix durable, rentable et intelligent. De plus vous valorisez votre habitation en cas de revente de celle-ci.</p>
    </div>
    <p style="font-size: 0.85em; color: #444; margin-top: 15px;" id="mentions"></p>
  </div>
  <!-- √Ä coller imm√©diatement APR√àS ceci :
<p style="font-size: 0.85em; color: #444; margin-top: 15px;" id="mentions"></p>
</div> -->

<div id="blocMail" style="display: none; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-top: 30px; max-width: 700px; margin-left: auto; margin-right: auto;">

  <p style="font-size: 1.2em; font-weight: bold; margin-bottom: 8px;">
    üì© Recevoir cette estimation par mail ?
  </p>
  <p style="margin-bottom: 20px;">
    Pour garder une trace de cette simulation ou en discuter plus tard, entrez simplement votre email.<br>
    <strong>C‚Äôest imm√©diat, sans engagement.</strong>
  </p>
  <form>
    <input type="email" placeholder="Votre adresse email" required
      style="width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 6px; border: none; background: #444; color: #fff; font-size: 1em; box-sizing: border-box;" />
    
    <input type="tel" placeholder="(Facultatif) Votre t√©l√©phone"
      style="width: 100%; padding: 12px; margin-bottom: 18px; border-radius: 6px; border: none; background: #444; color: #fff; font-size: 1em; box-sizing: border-box;" />
    
    <button type="submit"
      style="width: 100%; background: #0056d6; color: white; border: none; padding: 14px; font-size: 1.05em; border-radius: 8px; font-weight: bold; cursor: pointer;">
      Recevoir mon estimation
    </button>
  </form>
  <div style="margin-top: 20px; font-size: 0.9em; color: #444;">
    <p style="margin: 10px 0;">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è <strong>4,9/5 sur Google</strong> ‚Äì Plus de 400 foyers accompagn√©s en France.</p>
    <p style="margin: 10px 0;">üîí Vos donn√©es ne seront jamais revendues. Aucun d√©marchage automatique.</p>
  </div>
</div>


  <script>
    

    function afficherBlocFinancement(scenario, economieMensuelle, gain15ans) {
      const offre = {
  prix: scenario.prix,
  mensualite: scenario.mensualite,
  taeg: scenario.taeg,
  total: scenario.total
};


      if (offre) {
        document.getElementById("ecoMensuelle").innerHTML = `<strong>${Math.round(economieMensuelle).toLocaleString('fr-FR')} ‚Ç¨</strong>`;
        document.getElementById("eco15ans").innerHTML = `<strong>${Math.round(gain15ans).toLocaleString('fr-FR')} ‚Ç¨</strong>`;

        document.getElementById("mensualiteTexte").innerHTML = `
  <strong>Une mensualit√© fixe de ${offre.mensualite.toFixed(2).replace('.', ',')} ‚Ç¨*</strong>
  pour financer cette installation <strong>cl√© en main</strong> ‚Äî et ainsi devenir
  <strong>propri√©taire de votre production solaire</strong>.`;

       document.getElementById("mentions").innerText = `
* Exemple : installation ${scenario.puissance} √† ${offre.prix.toLocaleString('fr-FR')} ‚Ç¨
financement sur 180 mois au TAEG fixe de ${offre.taeg.toFixed(2).replace('.', ',')} %, mensualit√© ${offre.mensualite.toFixed(2).replace('.', ',')} ‚Ç¨ (hors assurance).
Co√ªt total du financement hors assurance : ${offre.total.toLocaleString('fr-FR')} ‚Ç¨.
Financement propos√© par notre partenaire Projexio, sous r√©serve d‚Äôacceptation. Un cr√©dit vous engage et doit √™tre rembours√©.
V√©rifiez vos capacit√©s de remboursement avant de vous engager.`;


        document.getElementById("offre").style.display = "block";
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      let scenarios = [];

const url = "https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec";

fetch(url)
  .then(response => response.json())
  .then(data => {
    scenarios = data.map(item => ({
      puissance: item.Puissance,
      prod: parseInt(item.Prod),
      seuil: parseInt(item.Seuil),
      panels: parseInt(item.Panels),
      prix: parseFloat(item.Prix),
      mensualite: parseFloat(item.Mensualite),
      taeg: parseFloat(item.Taeg),
      total: parseFloat(item.Total)
    }));
  })
  .catch(error => {
    console.error("Erreur lors du chargement des sc√©narios :", error);
    alert("Erreur lors du chargement des donn√©es du simulateur.");
  });


      document.getElementById("simuler").addEventListener("click", function calculerSimulation() {
        const conso = parseFloat(document.getElementById('conso').value);
        const facture = parseFloat(document.getElementById('facture').value);

        if (isNaN(conso) || isNaN(facture) || conso <= 0 || facture <= 0) {
          alert("Merci de remplir correctement les deux champs.");
          return;
        }

        const prixKwh = facture / conso;
        const scenario = [...scenarios].reverse().find(s => s.prod <= conso) || scenarios[0];
        scenarios.reverse();

        const autoKwh = scenario.prod * 0.6;
        const stockKwh = scenario.prod * 0.4;
        const acheminement = 0.05;

        const factureAvant = conso * prixKwh;
        const autoValue = autoKwh * prixKwh;
        const stockValue = stockKwh * prixKwh;
        const coutAcheminement = stockKwh * acheminement;
        const factureApres = factureAvant - autoValue - stockValue + coutAcheminement;
        const economieAnnuelle = factureAvant - factureApres;
        const economieAnnuelleCorrigee = Math.min(economieAnnuelle, facture);
        const economieMensuelle = economieAnnuelleCorrigee / 12;

        let gain15ans = 0;
        let prixActuel = prixKwh;
        for (let i = 0; i < 15; i++) {
          const autoVal = autoKwh * prixActuel;
          const stockVal = stockKwh * prixActuel;
          const coutAch = stockKwh * acheminement;
          const factureAv = conso * prixActuel;
          const factureAp = factureAv - autoVal - stockVal + coutAch;
          const economie = factureAv - factureAp;
          gain15ans += economie;
          prixActuel *= 1.05;
        }
       document.getElementById('recap').style.display = 'block';
document.getElementById('resultat').style.display = 'block';
document.getElementById('blocMail').style.display = 'block';
document.getElementById('blocImagePV').style.display = 'block';



document.getElementById('recap').innerHTML = `
  <p>Votre consommation annuelle actuelle : ${conso.toLocaleString('fr-FR')} kWh</p>
  <p>Votre facture annuelle actuelle : ${facture.toLocaleString('fr-FR')} ‚Ç¨</p>
  <p>Prix du kWh : ${prixKwh.toFixed(3)} ‚Ç¨</p>
  <p>Avec une puissance install√©e de : ${scenario.puissance} ‚Äî ${scenario.panels} panneaux photovolta√Øques de 500 W</p>
  <p>Production annuelle estim√©e : ${scenario.prod.toLocaleString('fr-FR')} kWh</p>
  <p>Autoconsommation : ${autoKwh.toLocaleString('fr-FR')} kWh (60 %)</p>
  <p>Surplus valoris√© via batterie virtuelle : ${stockKwh.toLocaleString('fr-FR')} kWh (40 %)</p>`;



        document.getElementById('resultat').innerHTML = `
          <p><strong>Puissance recommand√©e :</strong> ${scenario.puissance}</p>
          <p><strong>Gain estim√© la 1√®re ann√©e :</strong> ${Math.round(economieAnnuelleCorrigee).toLocaleString('fr-FR')} ‚Ç¨<br>
          <span style="font-weight: normal;">soit environ ${Math.round(economieMensuelle).toLocaleString('fr-FR')} ‚Ç¨ par mois</span></p>
          <p><strong>√âconomie cumul√©e sur 15 ans :</strong> ${Math.round(gain15ans).toLocaleString('fr-FR')} ‚Ç¨</p>
          <p>‚úÖ <em>Voici l‚Äô√©conomie r√©alisable gr√¢ce √† l‚Äôautoconsommation solaire et au stockage virtuel. Et ce n‚Äôest qu‚Äôune premi√®re estimation ! Une √©tude gratuite et personnalis√©e peut maintenant affiner votre gain r√©el selon votre toiture.</em></p>`;

        afficherBlocFinancement(scenario, economieMensuelle, gain15ans);
              document.querySelector("#blocMail form").addEventListener("submit", function(e) {
        e.preventDefault();

        const email = this.querySelector('input[type="email"]').value;
        const telephone = this.querySelector('input[type="tel"]').value;

        const payload = {
          codePostal: document.getElementById("codePostal").value,
          conso: parseFloat(document.getElementById("conso").value),
          facture: parseFloat(document.getElementById("facture").value),
          production: scenario.prod,
          economieAnnuelle: Math.round(economieAnnuelleCorrigee),
          economieMensuelle: Math.round(economieMensuelle),
          gain15ans: Math.round(gain15ans),
          puissance: scenario.puissance,
          panels: scenario.panels,
          prix: scenario.prix,
          mensualite: scenario.mensualite,
          taeg: scenario.taeg,
          total: scenario.total,
          email: email,
          telephone: telephone
        };

fetch("https://script.google.com/macros/s/AKfycbwhlyD_FMMm2g9JIQAm2Se2xehUqIM2MzWMl1YGl_gP1DJKM_-jZFj_YStDMhWi-0F8XA/exec", {
  method: "POST",
  mode: "no-cors", // ‚úÖ AJOUT OBLIGATOIRE POUR GITHUB
  body: JSON.stringify(payload),
  headers: {
    "Content-Type": "application/json"
  }
})
.then(res => {
  alert("‚úÖ Votre estimation a bien √©t√© transmise.");
})
.catch(err => {
  console.error("Erreur lors de l'envoi vers Sheets :", err);
  alert("‚ùå Une erreur est survenue. Merci de r√©essayer.");
});

      });

      });
    });
  </script>
</body>
</html>
